<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context" xmlns:jpa="http://www.springframework.org/schema/data/jpa"
    xmlns:cxf="http://cxf.apache.org/core" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jee="http://www.springframework.org/schema/jee"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
			http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
			http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa-1.3.xsd
			http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.2.xsd
			http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd">

    <import resource="classpath:batchSpringContext.xml" />
    <import resource="classpath:/wsSpringContext.xml" />
    <import resource="classpath:springContext-burrc.xml" />

    <!-- WS RCPR -->
    <!-- @RCPR : A activer si besoin -->
    <!-- <import resource="classpath:springContext-rcpr.xml" /> -->

    <import resource="classpath:/notificationIntraSpringContext.xml" />

    <context:component-scan base-package="fr.dsirc.gce" />

    <jpa:repositories base-package="fr.dsirc.gce" factory-class="fr.dsirc.fmk.commons.dao.CustomJpaRepositoryFactoryBean"
        transaction-manager-ref="transactionManager" entity-manager-factory-ref="entityManagerFactory" />

    <jee:jndi-lookup id="dataSourceMetier" jndi-name="jdbc/datasource" resource-ref="true" />
    <!-- cache -->
    <jee:jndi-lookup id="nativeCacheManager" jndi-name="cache/container" resource-ref="true" />

    <bean class="fr.dsirc.fmk.commons.bean.InformationApplicative">
        <property name="codeBrique" value="GCE" />
        <property name="codeQuartier" value="CPT" />
    </bean>

    <bean id="thread_master" class="java.lang.String">
        <constructor-arg>
            <jee:jndi-lookup id="default.thread.master" jndi-name="string/compenserAvantRecouvrement_thread_master"
                resource-ref="true" />
        </constructor-arg>
    </bean>

    <bean id="thread_worker" class="java.lang.String">
        <constructor-arg>
            <jee:jndi-lookup id="default.thread.worker" jndi-name="string/compenserAvantRecouvrement_thread_worker"
                resource-ref="true" />
        </constructor-arg>
    </bean>

    <bean id="handlertimeout" class="java.lang.String">
        <constructor-arg>
            <jee:jndi-lookup id="default.timeout" jndi-name="string/compenserAvantRecouvrement_handlertimeout" resource-ref="true" />
        </constructor-arg>
    </bean>
    <bean id="gatewaytimeout" class="java.lang.String">
        <constructor-arg>
            <jee:jndi-lookup id="default.timeout" jndi-name="string/compenserAvantRecouvrement_gatewaytimeout" resource-ref="true" />
        </constructor-arg>
    </bean>

    <bean id="batch_fetch_size" class="java.lang.String">
        <constructor-arg>
            <jee:jndi-lookup id="default.batch_fetch_size" jndi-name="string/compenserAvantRecouvrement_batch_fetch_size"
                resource-ref="true" />
        </constructor-arg>
    </bean>

    <!-- Purger tous les caches au démarrage de l'application -->
    <bean class="fr.dsirc.fmk.commons.cache.GlobalCacheManagementConfiguration">
        <property name="storeAsBinary" ref="storeCachedValueAsBinary" />
        <property name="clearOnDeploy" value="true" />
    </bean>



    <bean id="storeCachedValueAsBinary" class="java.lang.Boolean">
        <constructor-arg>
            <jee:jndi-lookup jndi-name="string/gce_binary_cache_batch" resource-ref="true" />
        </constructor-arg>
    </bean>

    <util:map id="extendedJpaPropertiesMap" map-class="java.util.HashMap">
        <entry key="hibernate.default_batch_fetch_size" value="#{batch_fetch_size}" />
    </util:map>
    <!--
        Upgrade themis 3.4.5
        Standard d'interopérabilité dédié aux appels d'API REST entre applications d'organismes différents (point à point)
    -->
    <bean class="fr.dsirc.fmk.commons.interopsr.InteropsRUserInfo">
        <constructor-arg type="java.lang.String" value="urn:interops:agirc-arrco" />
        <constructor-arg type="java.lang.String" value="" />
    </bean>

</beans>
